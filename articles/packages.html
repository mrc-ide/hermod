<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Packages and provisioning • hipercow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Packages and provisioning">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hipercow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.52</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hipercow.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>General</h6></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Packages and provisioning</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Parallel Tasks</a></li>
    <li><a class="dropdown-item" href="../articles/troubleshooting.html">Troubleshooting</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/environments.html">Environments</a></li>
    <li><a class="dropdown-item" href="../articles/stan.html">Using stan</a></li>
    <li><a class="dropdown-item" href="../articles/INLA.html">Using INLA on Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Clusters</h6></li>
    <li><a class="dropdown-item" href="../articles/windows.html">Windows</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced topics</h6></li>
    <li><a class="dropdown-item" href="../articles/workers.html">Workers</a></li>
    <li><a class="dropdown-item" href="../articles/administration.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/migration.html">Migration from didehpc</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/hipercow/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Packages and provisioning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/hipercow/blob/main/vignettes/packages.Rmd" class="external-link"><code>vignettes/packages.Rmd</code></a></small>
      <div class="d-none name"><code>packages.Rmd</code></div>
    </div>

    
    
<!-- 
    This vignette builds fine locally, and can probably be built ok
    on the cluster, but it's also quite slow to build and will be subject
    to network issues/package failures so it's not totally desirable that
    it builds every commit either.
    
    In its current form, it does not use the windows cluster at all,
    and uses the example driver, just like hipercow.Rmd etc.
-->
<!-- Please edit the file in vignettes_src/ -->
<p>Depending on where they come from and how specific you need to be on
versioning, getting packages available for your cluster tasks ranges
from very straightforward to a constant struggle.</p>
<p>We install packages into a special directory within
<code>hipercow/</code> by running a special job on the cluster itself
using our <a href="https://mrc-ide.github.io/conan2" class="external-link"><code>conan2</code></a> package.
This aims to solve most of the common situations that we have seen, and
has a couple of escape hatches that we hope will help with future
problems.</p>
<p>There are three broad approaches to installing packages that we
support:</p>
<ul>
<li>Dependency resolution and package installation using <a href="https://r-lib.github.io/pkgdepends" class="external-link"><code>pkgdepends</code></a>
(<code>method = "pkgdepends"</code>)</li>
<li>A totally automatic method that uses <code>pkgdepends</code> but
tries to just work out everything itself
(<code>method = "auto"</code>)</li>
<li>A bespoke script that you write yourself, and we run
(<code>method = "script"</code>)</li>
<li>Reproducible project environments with <a href="https://rstudio.github.io/renv/" class="external-link"><code>renv</code></a>
(<code>method = "renv"</code>)</li>
</ul>
<p>We expect that packages might come from any number of places:</p>
<ul>
<li>CRAN or Bioconductor</li>
<li>A CRAN-like repository (such as an <a href="https://mrc-ide.r-universe.dev" class="external-link">“R universe”</a> or a drat
repository)</li>
<li>A <strong>public</strong> GitHub repository, which one might
ordinarily install via <code>remotes::install_github()</code>
</li>
<li>Local sources, available on your computer and in the hipercow
directory</li>
</ul>
<p>We don’t currently support packages from private repositories, but
let us know if that is a problem for you. We have a plan to support this
later in 2024.</p>
<p>This all ends up being a lot of flexibility, so our (current)
suggestion if you are starting out is to use the <code>pkgdepends</code>
method with the <code>pkgdepends.txt</code> configuration a starting
point as this will be the easiest for us to replicate issues with, and
should end up being the most predictable.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/hipercow" class="external-link">hipercow</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="using-pkgdepends">Using <code>pkgdepends</code><a class="anchor" aria-label="anchor" href="#using-pkgdepends"></a>
</h2>
<p>This is the method that is least prescriptive on your workflow and
simplest. We recommend this as a good starting place.</p>
<p>There are two places that we might get lists of packages to
install:</p>
<ul>
<li>From a file <code>pkgdepends.txt</code> in the directory that also
contains the <code>hipercow/</code> directory</li>
<li>Manually, within a call to <code><a href="../reference/hipercow_provision.html">hipercow_provision()</a></code>
</li>
</ul>
<p>We’ll consider these in turn here.</p>
<div class="section level3">
<h3 id="a-list-of-packages">A list of packages<a class="anchor" aria-label="anchor" href="#a-list-of-packages"></a>
</h3>
<p>Create a file called <code>pkgdepends.txt</code> at the top of the
hipercow root. This file has a very simple format, with each line being
the name of a package, or a <a href="https://r-lib.github.io/pkgdepends/reference/pkg_refs.html" class="external-link"><code>pkgdepends</code>
“package reference”</a>, plus support for comments, blank lines and
specifying additional repositories to install from.</p>
<p>So a complex case might look like</p>
<pre><code># Also use the ncov-ic universe
repo::https://ncov-ic.r-universe.dev

# Specific version of malaria simulation, via a tag
mrc-ide/malariasimulation@v1.6.0

# Package from CRAN
coda</code></pre>
<ul>
<li>Blank lines are ignored</li>
<li>Lines starting with <code>#</code> are comments and are also
ignored</li>
<li>Entries are separated by newlines</li>
<li>Lines like <code>coda</code> represent packages from CRAN or another
CRAN-like repository</li>
<li>Lines like <code>mrc-ide/malariasimulation@v1.6.0</code> are a
pkgdepends reference and can be quite complex to control what version is
installed</li>
<li>Lines like <code>repo::https://ncov-ic.r-universe.dev</code> add
additional CRAN-like repositories (this is the recommended way of
installing some of our packages such as <code>odin</code> or
<code>orderly2</code>)</li>
<li>You can install packages that you have a <code>.tar.gz</code> for by
adding a line like <code>local::./mypkg_0.1.0.tar.gz</code> where the
path is relative to your hipercow root folder.</li>
</ul>
<p>The <a href="https://r-lib.github.io/pkgdepends/reference/pkg_refs.html" class="external-link"><code>pkgdepends</code>
docs</a> provide lots of nice examples on package references. Note that
the <code>repo::&lt;url&gt;</code> line is an extension to this.</p>
<p>We have an new empty hipercow root, containing a simple
<code>pkgdepends.txt</code> file:</p>
<pre><code><span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; ├── hipercow</span></span>
<span><span class="co">#&gt; └── pkgdepends.txt</span></span></code></pre>
<p>The <code>pkgdepends.txt</code> file contains simply:</p>
<pre><code><span><span class="va">cowsay</span></span></code></pre>
<p>We can provision this environment by running</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'pkgdepends'</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib</span></span>
<span><span class="co">#&gt; Using method pkgdepends</span></span>
<span><span class="co">#&gt; Running in path: /tmp/Rtmp0FgkdQ/file1af6fc77685796</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - /tmp/Rtmp0FgkdQ/file1af6fc77685796/hipercow/lib</span></span>
<span><span class="co">#&gt;   - /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/library</span></span>
<span><span class="co">#&gt; id: 20240126113025</span></span>
<span><span class="co">#&gt; Logs from pkgdepends follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── repos </span></span>
<span><span class="co">#&gt; • https://cloud.r-project.org</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── refs </span></span>
<span><span class="co">#&gt; • cowsay</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✔ Updated metadata database: 4.19 MB in 9 files.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Updating metadata database</span></span>
<span><span class="co">#&gt; ✔ Updating metadata database ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; + cowsay     0.9.0 [bld][dl]</span></span>
<span><span class="co">#&gt; + crayon     1.5.2 [bld][dl]</span></span>
<span><span class="co">#&gt; + fortunes   1.5-4 [bld][dl]</span></span>
<span><span class="co">#&gt; + rmsfact    0.0.3 [bld][dl]</span></span>
<span><span class="co">#&gt; ℹ Getting 4 pkgs with unknown sizes</span></span>
<span><span class="co">#&gt; ✔ Got rmsfact 0.0.3 (source) (10.73 kB)</span></span>
<span><span class="co">#&gt; ✔ Got fortunes 1.5-4 (source) (192.94 kB)</span></span>
<span><span class="co">#&gt; ✔ Got crayon 1.5.2 (source) (40.57 kB)</span></span>
<span><span class="co">#&gt; ✔ Got cowsay 0.9.0 (source) (573.56 kB)</span></span>
<span><span class="co">#&gt; ℹ Building crayon 1.5.2</span></span>
<span><span class="co">#&gt; ℹ Building fortunes 1.5-4</span></span>
<span><span class="co">#&gt; ℹ Building rmsfact 0.0.3</span></span>
<span><span class="co">#&gt; ✔ Built rmsfact 0.0.3 (883ms)</span></span>
<span><span class="co">#&gt; ✔ Built fortunes 1.5-4 (1s)</span></span>
<span><span class="co">#&gt; ✔ Installed rmsfact 0.0.3  (46ms)</span></span>
<span><span class="co">#&gt; ✔ Installed fortunes 1.5-4  (29ms)</span></span>
<span><span class="co">#&gt; ✔ Built crayon 1.5.2 (1.6s)</span></span>
<span><span class="co">#&gt; ✔ Installed crayon 1.5.2  (12ms)</span></span>
<span><span class="co">#&gt; ℹ Building cowsay 0.9.0</span></span>
<span><span class="co">#&gt; ✔ Built cowsay 0.9.0 (806ms)</span></span>
<span><span class="co">#&gt; ✔ Installed cowsay 0.9.0  (17ms)</span></span>
<span><span class="co">#&gt; ✔ Summary:   4 new  in 4.4s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/.conan/20240126113025'</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<p>This launches a small task on the cluster and uses
<code>pkgdepends</code> to install <code>cowsay</code> and all its
dependencies. If recent installations have been attempted, it will use
cached copies, which should make things fairly snappy.</p>
<p>Once installed we can run a task that uses this package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">cowsay</span><span class="fu">::</span><span class="fu">say</span><span class="op">(</span><span class="st">"HiperMoo"</span>, <span class="st">"cow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Submitted task '1d520a4efa59c757917b2ad74148a48c' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── hipercow 0.2.33 running at '/tmp/Rtmp0FgkdQ/file1af6fc77685796' ─────────────</span></span>
<span><span class="co">#&gt; ℹ library paths:</span></span>
<span><span class="co">#&gt; • /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; • /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/library</span></span>
<span><span class="co">#&gt; ℹ id: 1d520a4efa59c757917b2ad74148a48c</span></span>
<span><span class="co">#&gt; ℹ starting at: 2024-01-26 11:30:34.348013</span></span>
<span><span class="co">#&gt; ℹ task type: expression</span></span>
<span><span class="co">#&gt; ℹ expression: cowsay::say("HiperMoo", "cow")</span></span>
<span><span class="co">#&gt; ℹ no local variables</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↓ ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ----- </span></span>
<span><span class="co">#&gt; HiperMoo </span></span>
<span><span class="co">#&gt;  ------ </span></span>
<span><span class="co">#&gt;     \   ^__^ </span></span>
<span><span class="co">#&gt;      \  (oo)\ ________ </span></span>
<span><span class="co">#&gt;         (__)\         )\ /\ </span></span>
<span><span class="co">#&gt;              ||------w|</span></span>
<span><span class="co">#&gt;              ||      ||</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↑ ──</span></span>
<span><span class="co">#&gt; ✔ status: success</span></span>
<span><span class="co">#&gt; ℹ finishing at: 2024-01-26 11:30:34.348013 (elapsed: 0.1545 secs)</span></span></code></pre></div>
<p>For all methods of provisioning you can see what has been done
previously by running <code><a href="../reference/hipercow_provision_list.html">hipercow_provision_list()</a></code> and
<code><a href="../reference/hipercow_provision_list.html">hipercow_provision_check()</a></code>. Running
<code><a href="../reference/hipercow_provision_list.html">hipercow_provision_list()</a></code> just lists the installations into
your library:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision_list.html">hipercow_provision_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ 1 conan installation recorded</span></span>
<span><span class="co">#&gt; • 1: 20240126113025 (moments ago) [0]</span></span></code></pre></div>
<p>The <code><a href="../reference/hipercow_provision_list.html">hipercow_provision_check()</a></code> function also compares
previously performed installations with the what
<code><a href="../reference/hipercow_provision.html">hipercow_provision()</a></code> would do with the same arguments:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision_list.html">hipercow_provision_check</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'pkgdepends'</span></span>
<span><span class="co">#&gt; ℹ 1 conan installation recorded</span></span>
<span><span class="co">#&gt; • 1: 20240126113025 (moments ago) [0] (*)</span></span>
<span><span class="co">#&gt; ℹ The entry marked with '*' matches the provided installation hash</span></span></code></pre></div>
<p>You can see what is in a library by using
<code><a href="../reference/hipercow_provision_compare.html">hipercow_provision_compare()</a></code>; this compares between two
versions of the library. Because we only have one version here the
comparison will be against the empty library:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision_compare.html">hipercow_provision_compare</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Comparing conan installations ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; • (empty installation)</span></span>
<span><span class="co">#&gt; • 20240126113025 1st; current installation (moments ago)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── 4 added packages ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • cowsay (0.9.0) CRAN</span></span>
<span><span class="co">#&gt; • crayon (1.5.2) CRAN</span></span>
<span><span class="co">#&gt; • fortunes (1.5.4) CRAN</span></span>
<span><span class="co">#&gt; • rmsfact (0.0.3) CRAN</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="manually">Manually<a class="anchor" aria-label="anchor" href="#manually"></a>
</h3>
<p>Sometimes, regardless of how things are installed, you need to
install something manually. For example, you just want to change the
version being used of some package, or <code>pkgdepends</code> fails to
resolve a nice set of dependencies from some complex interdependent set
of packages and you want to install a specific version on top of
everything it did.</p>
<p>To do this, <code>hipercow_provision</code> with
<code>method = "pkgdepends"</code> and <code>refs</code> as a character
vector of package references, following the same format as
<code>pkgdepends.txt</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"pkgdepends"</span>, refs <span class="op">=</span> <span class="st">"cran::coda"</span><span class="op">)</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib</span></span>
<span><span class="co">#&gt; Using method pkgdepends</span></span>
<span><span class="co">#&gt; Running in path: /tmp/Rtmp0FgkdQ/file1af6fc77685796</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - /tmp/Rtmp0FgkdQ/file1af6fc77685796/hipercow/lib</span></span>
<span><span class="co">#&gt;   - /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/library</span></span>
<span><span class="co">#&gt; id: 20240126113035</span></span>
<span><span class="co">#&gt; Logs from pkgdepends follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── repos </span></span>
<span><span class="co">#&gt; • https://cloud.r-project.org</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── refs </span></span>
<span><span class="co">#&gt; • cran::coda</span></span>
<span><span class="co">#&gt; ℹ Loading metadata database</span></span>
<span><span class="co">#&gt; ✔ Loading metadata database ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; + coda   0.19-4 [bld]</span></span>
<span><span class="co">#&gt; ℹ No downloads are needed, 1 pkg is cached</span></span>
<span><span class="co">#&gt; ✔ Got coda 0.19-4 (source) (74.24 kB)</span></span>
<span><span class="co">#&gt; ℹ Building coda 0.19-4</span></span>
<span><span class="co">#&gt; ✔ Built coda 0.19-4 (1.8s)</span></span>
<span><span class="co">#&gt; ✔ Installed coda 0.19-4  (13ms)</span></span>
<span><span class="co">#&gt; ✔ Summary:   1 new   1 kept  in 1.8s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/.conan/20240126113035'</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<p>Now <code><a href="../reference/hipercow_provision_list.html">hipercow_provision_list()</a></code> and
hipercow_provision_compare()` show we have two steps in the history of
the library and we can see what has changed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision_list.html">hipercow_provision_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ 2 conan installations recorded</span></span>
<span><span class="co">#&gt; • 1: 20240126113025 (moments ago) [-1]</span></span>
<span><span class="co">#&gt; • 2: 20240126113035 (moments ago) [0]</span></span>
<span><span class="fu"><a href="../reference/hipercow_provision_compare.html">hipercow_provision_compare</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Comparing conan installations ───────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; • 20240126113025 1st; previous installation (moments ago)</span></span>
<span><span class="co">#&gt; • 20240126113035 2nd; current installation (moments ago)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── 4 unchanged packages ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ To show unchanged packages, print with 'show_unchanged = TRUE'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── 1 added package ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; • coda (0.19.4) CRAN</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="automatically-from-an-environment">Automatically, from an environment<a class="anchor" aria-label="anchor" href="#automatically-from-an-environment"></a>
</h2>
<p>The <code>pkgdepends</code> approach above duplicates some
information already present in the packages listed in your calls to
<code>hipercow_environment()</code>, implied in the files
<code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>’d at the start of your task and from the local
metadata about where your packages were installed from in the first
place.</p>
<p>We try to poke around in your script files and find all the packages
that you use, then we look at your installation, and from that build a
set of references that we hope will recreate the installation.</p>
<p>We have an new empty hipercow root, this time containing some source
file <code>src.R</code>:</p>
<pre><code><span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; ├── hipercow</span></span>
<span><span class="co">#&gt; └── src.R</span></span></code></pre>
<p>The file <code>src.R</code> contains the code that we want to run on
the cluster:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cowsay_fact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">cowsay</span><span class="fu">::</span><span class="fu">say</span><span class="op">(</span><span class="st">"catfact"</span>, <span class="st">"cow"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We tell hipercow about this:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_environment.html">hipercow_environment_create</a></span><span class="op">(</span>sources <span class="op">=</span> <span class="st">"src.R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Created environment 'default'</span></span></code></pre></div>
<p>Now, when we run <code><a href="../reference/hipercow_provision.html">hipercow_provision()</a></code>,
<code>hipercow</code> will check through our <code>src.R</code> file and
seen that we use <code>cowsay</code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'auto'</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib</span></span>
<span><span class="co">#&gt; Using method auto</span></span>
<span><span class="co">#&gt; Running in path: /tmp/Rtmp0FgkdQ/file1af6fc1833a1ef</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - /tmp/Rtmp0FgkdQ/file1af6fc1833a1ef/hipercow/lib</span></span>
<span><span class="co">#&gt;   - /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/library</span></span>
<span><span class="co">#&gt; id: 20240126113040</span></span>
<span><span class="co">#&gt; Logs from pkgdepends follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── repos </span></span>
<span><span class="co">#&gt; • https://cloud.r-project.org</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── refs </span></span>
<span><span class="co">#&gt; • cowsay</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ✔ Updated metadata database: 4.19 MB in 9 files.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ℹ Updating metadata database</span></span>
<span><span class="co">#&gt; ✔ Updating metadata database ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ! Failed to update system requirement mappings, will use cached mappings.</span></span>
<span><span class="co">#&gt; + cowsay     0.9.0 [bld][dl]</span></span>
<span><span class="co">#&gt; + crayon     1.5.2 [bld][dl]</span></span>
<span><span class="co">#&gt; + fortunes   1.5-4 [bld][dl]</span></span>
<span><span class="co">#&gt; + rmsfact    0.0.3 [bld][dl]</span></span>
<span><span class="co">#&gt; ℹ Getting 4 pkgs with unknown sizes</span></span>
<span><span class="co">#&gt; ✔ Got crayon 1.5.2 (source) (40.57 kB)</span></span>
<span><span class="co">#&gt; ✔ Got rmsfact 0.0.3 (source) (10.73 kB)</span></span>
<span><span class="co">#&gt; ✔ Got fortunes 1.5-4 (source) (192.94 kB)</span></span>
<span><span class="co">#&gt; ✔ Got cowsay 0.9.0 (source) (573.56 kB)</span></span>
<span><span class="co">#&gt; ℹ Building crayon 1.5.2</span></span>
<span><span class="co">#&gt; ℹ Building fortunes 1.5-4</span></span>
<span><span class="co">#&gt; ℹ Building rmsfact 0.0.3</span></span>
<span><span class="co">#&gt; ✔ Built rmsfact 0.0.3 (880ms)</span></span>
<span><span class="co">#&gt; ✔ Built fortunes 1.5-4 (985ms)</span></span>
<span><span class="co">#&gt; ✔ Installed rmsfact 0.0.3  (44ms)</span></span>
<span><span class="co">#&gt; ✔ Installed fortunes 1.5-4  (29ms)</span></span>
<span><span class="co">#&gt; ✔ Built crayon 1.5.2 (1.5s)</span></span>
<span><span class="co">#&gt; ✔ Installed crayon 1.5.2  (34ms)</span></span>
<span><span class="co">#&gt; ℹ Building cowsay 0.9.0</span></span>
<span><span class="co">#&gt; ✔ Built cowsay 0.9.0 (803ms)</span></span>
<span><span class="co">#&gt; ✔ Installed cowsay 0.9.0  (17ms)</span></span>
<span><span class="co">#&gt; ✔ Summary:   4 new  in 4.3s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/.conan/20240126113040'</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<p>Now our code works!</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">cowsay_fact</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Submitted task '90d0a213194dbc448f0af38f3b5ac31e' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── hipercow 0.2.33 running at '/tmp/Rtmp0FgkdQ/file1af6fc1833a1ef' ─────────────</span></span>
<span><span class="co">#&gt; ℹ library paths:</span></span>
<span><span class="co">#&gt; • /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; • /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/library</span></span>
<span><span class="co">#&gt; ℹ id: 90d0a213194dbc448f0af38f3b5ac31e</span></span>
<span><span class="co">#&gt; ℹ starting at: 2024-01-26 11:30:48.655369</span></span>
<span><span class="co">#&gt; ℹ task type: expression</span></span>
<span><span class="co">#&gt; ℹ expression: cowsay_fact()</span></span>
<span><span class="co">#&gt; ℹ no local variables</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↓ ──</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  -------------- </span></span>
<span><span class="co">#&gt; Your cat's heart beats at a rate almost double that of yours, from 110-140 beats per minute. </span></span>
<span><span class="co">#&gt;  --------------</span></span>
<span><span class="co">#&gt;     \</span></span>
<span><span class="co">#&gt;       \</span></span>
<span><span class="co">#&gt;         \</span></span>
<span><span class="co">#&gt;             |\___/|</span></span>
<span><span class="co">#&gt;           ==) ^Y^ (==</span></span>
<span><span class="co">#&gt;             \  ^  /</span></span>
<span><span class="co">#&gt;              )=*=(</span></span>
<span><span class="co">#&gt;             /     \</span></span>
<span><span class="co">#&gt;             |     |</span></span>
<span><span class="co">#&gt;            /| | | |\</span></span>
<span><span class="co">#&gt;            \| | |_|/\</span></span>
<span><span class="co">#&gt;       jgs  //_// ___/</span></span>
<span><span class="co">#&gt;                \_)</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↑ ──</span></span>
<span><span class="co">#&gt; ✔ status: success</span></span>
<span><span class="co">#&gt; ℹ finishing at: 2024-01-26 11:30:48.655369 (elapsed: 0.9717 secs)</span></span></code></pre></div>
<p>If we had installed <code>cowsay</code> initially by running
<code>remotes::install_github()</code> it would have noticed this and
installed the package that way. For example, the <a href="https://richfitz.github.io/rfiglet" class="external-link"><code>rfiglet</code>
package</a> is not available on CRAN and must be installed via
<code>remotes</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"richfitz/rfiglet"</span><span class="op">)</span></span></code></pre></div>
<p>I’ve adjusted our <code>src.R</code> to use <code>rfiglet</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cowsay_fact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">cowsay</span><span class="fu">::</span><span class="fu">say</span><span class="op">(</span><span class="st">"catfact"</span>, <span class="st">"cow"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">figlet_date</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">rfiglet</span><span class="fu">::</span><span class="fu">figlet</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>and now when we call <code><a href="../reference/hipercow_provision.html">hipercow_provision()</a></code> you can see it
installs rfiglet too, automatically finding it on GitHub!</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'auto'</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib</span></span>
<span><span class="co">#&gt; Using method auto</span></span>
<span><span class="co">#&gt; Running in path: /tmp/Rtmp0FgkdQ/file1af6fc1833a1ef</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - /tmp/Rtmp0FgkdQ/file1af6fc1833a1ef/hipercow/lib</span></span>
<span><span class="co">#&gt;   - /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/library</span></span>
<span><span class="co">#&gt; id: 20240126113050</span></span>
<span><span class="co">#&gt; Logs from pkgdepends follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── repos </span></span>
<span><span class="co">#&gt; • https://cloud.r-project.org</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── refs </span></span>
<span><span class="co">#&gt; • cowsay</span></span>
<span><span class="co">#&gt; • richfitz/rfiglet@HEAD</span></span>
<span><span class="co">#&gt; ℹ Loading metadata database</span></span>
<span><span class="co">#&gt; ✔ Loading metadata database ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; + rfiglet   0.2.0 [bld][cmp] (GitHub: d713c1b)</span></span>
<span><span class="co">#&gt; ℹ No downloads are needed, 1 pkg is cached</span></span>
<span><span class="co">#&gt; ✔ Got rfiglet 0.2.0 (source) (144.05 kB)</span></span>
<span><span class="co">#&gt; ℹ Packaging rfiglet 0.2.0</span></span>
<span><span class="co">#&gt; ✔ Packaged rfiglet 0.2.0 (318ms)</span></span>
<span><span class="co">#&gt; ℹ Building rfiglet 0.2.0</span></span>
<span><span class="co">#&gt; ✔ Built rfiglet 0.2.0 (979ms)</span></span>
<span><span class="co">#&gt; ✔ Installed rfiglet 0.2.0 (github::richfitz/rfiglet@d713c1b) (14ms)</span></span>
<span><span class="co">#&gt; ✔ Summary:   1 new   4 kept  in 992ms</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/.conan/20240126113050'</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/task_create_expr.html">task_create_expr</a></span><span class="op">(</span><span class="fu">figlet_date</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Submitted task 'eb00966e02cecd38fddb79e8b262b59d' using 'example'</span></span>
<span><span class="fu"><a href="../reference/task_wait.html">task_wait</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/task_log.html">task_log_show</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── hipercow 0.2.33 running at '/tmp/Rtmp0FgkdQ/file1af6fc1833a1ef' ─────────────</span></span>
<span><span class="co">#&gt; ℹ library paths:</span></span>
<span><span class="co">#&gt; • /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; • /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt; • /usr/lib/R/library</span></span>
<span><span class="co">#&gt; ℹ id: eb00966e02cecd38fddb79e8b262b59d</span></span>
<span><span class="co">#&gt; ℹ starting at: 2024-01-26 11:30:55.72189</span></span>
<span><span class="co">#&gt; ℹ task type: expression</span></span>
<span><span class="co">#&gt; ℹ expression: figlet_date()</span></span>
<span><span class="co">#&gt; ℹ no local variables</span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↓ ──</span></span>
<span><span class="co">#&gt;  ____   ___ ____  _  _          ___  _      ____   __</span></span>
<span><span class="co">#&gt; |___ \ / _ \___ \| || |        / _ \/ |    |___ \ / /_</span></span>
<span><span class="co">#&gt;   __) | | | |__) | || |_ _____| | | | |_____ __) | '_ \</span></span>
<span><span class="co">#&gt;  / __/| |_| / __/|__   _|_____| |_| | |_____/ __/| (_) |</span></span>
<span><span class="co">#&gt; |_____|\___/_____|  |_|        \___/|_|    |_____|\___/</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ───────────────────────────────────────────────────────────────── task logs ↑ ──</span></span>
<span><span class="co">#&gt; ✔ status: success</span></span>
<span><span class="co">#&gt; ℹ finishing at: 2024-01-26 11:30:55.72189 (elapsed: 0.1573 secs)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-a-script">Using a script<a class="anchor" aria-label="anchor" href="#using-a-script"></a>
</h2>
<p>Sometimes you just need a lot more control than
<code>pkgdepends</code> can provide and you want to do your own thing.
To support this, create a file <code>provision.R</code> in the root of
your hipercow repository and within this write whatever you want to
install packages.</p>
<p>Here, we have another empty hipercow root, containing a file
<code>provision.R</code>:</p>
<pre><code><span><span class="co">#&gt; .</span></span>
<span><span class="co">#&gt; ├── hipercow</span></span>
<span><span class="co">#&gt; └── provision.R</span></span></code></pre>
<p>The <code>provision.R</code> file contains simply:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cowsay"</span><span class="op">)</span></span>
<span><span class="fu">cowsay</span><span class="fu">::</span><span class="fu">say</span><span class="op">(</span><span class="st">"Moo"</span>, <span class="st">"cow"</span><span class="op">)</span></span></code></pre></div>
<p>Here, it’s very simple, and just installs the package (plus runs a
simple function from it).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Selected provisioning method 'script'</span></span>
<span><span class="co">#&gt; /`-'\  _______  ___  ___ ____</span></span>
<span><span class="co">#&gt; \,T./ / __/ _ \/ _ \/ _ `/ _ \</span></span>
<span><span class="co">#&gt;   |   \__/\___/_//_/\_,_/_//_/</span></span>
<span><span class="co">#&gt;   |   ---- THE  LIBRARIAN ----</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Bootstrapping from: /home/rfitzjoh/lib/R/library</span></span>
<span><span class="co">#&gt; Installing into library: hipercow/lib</span></span>
<span><span class="co">#&gt; Using method script</span></span>
<span><span class="co">#&gt; Running in path: /tmp/Rtmp0FgkdQ/file1af6fc18c44b73</span></span>
<span><span class="co">#&gt; Library paths:</span></span>
<span><span class="co">#&gt;   - /tmp/Rtmp0FgkdQ/file1af6fc18c44b73/hipercow/lib</span></span>
<span><span class="co">#&gt;   - /usr/local/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/site-library</span></span>
<span><span class="co">#&gt;   - /usr/lib/R/library</span></span>
<span><span class="co">#&gt; id: 20240126113056</span></span>
<span><span class="co">#&gt; Logs from your installation script 'provision.R' follow:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; install.packages("cowsay")</span></span>
<span><span class="co">#&gt; Installing package into ‘/tmp/Rtmp0FgkdQ/file1af6fc18c44b73/hipercow/lib’</span></span>
<span><span class="co">#&gt; (as ‘lib’ is unspecified)</span></span>
<span><span class="co">#&gt; also installing the dependencies ‘crayon’, ‘fortunes’, ‘rmsfact’</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trying URL 'https://cloud.r-project.org/src/contrib/crayon_1.5.2.tar.gz'</span></span>
<span><span class="co">#&gt; Content type 'application/x-gzip' length 40567 bytes (39 KB)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span><span class="co">#&gt; downloaded 39 KB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trying URL 'https://cloud.r-project.org/src/contrib/fortunes_1.5-4.tar.gz'</span></span>
<span><span class="co">#&gt; Content type 'application/x-gzip' length 192938 bytes (188 KB)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span><span class="co">#&gt; downloaded 188 KB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trying URL 'https://cloud.r-project.org/src/contrib/rmsfact_0.0.3.tar.gz'</span></span>
<span><span class="co">#&gt; Content type 'application/x-gzip' length 10728 bytes (10 KB)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span><span class="co">#&gt; downloaded 10 KB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; trying URL 'https://cloud.r-project.org/src/contrib/cowsay_0.9.0.tar.gz'</span></span>
<span><span class="co">#&gt; Content type 'application/x-gzip' length 573560 bytes (560 KB)</span></span>
<span><span class="co">#&gt; ==================================================</span></span>
<span><span class="co">#&gt; downloaded 560 KB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * installing *source* package ‘crayon’ ...</span></span>
<span><span class="co">#&gt; ** package ‘crayon’ successfully unpacked and MD5 sums checked</span></span>
<span><span class="co">#&gt; ** using staged installation</span></span>
<span><span class="co">#&gt; ** R</span></span>
<span><span class="co">#&gt; ** byte-compile and prepare package for lazy loading</span></span>
<span><span class="co">#&gt; ** help</span></span>
<span><span class="co">#&gt; *** installing help indices</span></span>
<span><span class="co">#&gt; ** building package indices</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from temporary location</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from final location</span></span>
<span><span class="co">#&gt; ** testing if installed package keeps a record of temporary installation path</span></span>
<span><span class="co">#&gt; * DONE (crayon)</span></span>
<span><span class="co">#&gt; * installing *source* package ‘fortunes’ ...</span></span>
<span><span class="co">#&gt; ** package ‘fortunes’ successfully unpacked and MD5 sums checked</span></span>
<span><span class="co">#&gt; ** using staged installation</span></span>
<span><span class="co">#&gt; ** R</span></span>
<span><span class="co">#&gt; ** inst</span></span>
<span><span class="co">#&gt; ** byte-compile and prepare package for lazy loading</span></span>
<span><span class="co">#&gt; ** help</span></span>
<span><span class="co">#&gt; *** installing help indices</span></span>
<span><span class="co">#&gt; ** building package indices</span></span>
<span><span class="co">#&gt; ** installing vignettes</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from temporary location</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from final location</span></span>
<span><span class="co">#&gt; ** testing if installed package keeps a record of temporary installation path</span></span>
<span><span class="co">#&gt; * DONE (fortunes)</span></span>
<span><span class="co">#&gt; * installing *source* package ‘rmsfact’ ...</span></span>
<span><span class="co">#&gt; ** package ‘rmsfact’ successfully unpacked and MD5 sums checked</span></span>
<span><span class="co">#&gt; ** using staged installation</span></span>
<span><span class="co">#&gt; ** R</span></span>
<span><span class="co">#&gt; ** inst</span></span>
<span><span class="co">#&gt; ** byte-compile and prepare package for lazy loading</span></span>
<span><span class="co">#&gt; ** help</span></span>
<span><span class="co">#&gt; *** installing help indices</span></span>
<span><span class="co">#&gt; ** building package indices</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from temporary location</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from final location</span></span>
<span><span class="co">#&gt; ** testing if installed package keeps a record of temporary installation path</span></span>
<span><span class="co">#&gt; * DONE (rmsfact)</span></span>
<span><span class="co">#&gt; * installing *source* package ‘cowsay’ ...</span></span>
<span><span class="co">#&gt; ** package ‘cowsay’ successfully unpacked and MD5 sums checked</span></span>
<span><span class="co">#&gt; ** using staged installation</span></span>
<span><span class="co">#&gt; ** R</span></span>
<span><span class="co">#&gt; ** inst</span></span>
<span><span class="co">#&gt; ** byte-compile and prepare package for lazy loading</span></span>
<span><span class="co">#&gt; ** help</span></span>
<span><span class="co">#&gt; *** installing help indices</span></span>
<span><span class="co">#&gt; ** building package indices</span></span>
<span><span class="co">#&gt; ** installing vignettes</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from temporary location</span></span>
<span><span class="co">#&gt; ** testing if installed package can be loaded from final location</span></span>
<span><span class="co">#&gt; ** testing if installed package keeps a record of temporary installation path</span></span>
<span><span class="co">#&gt; * DONE (cowsay)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The downloaded source packages are in</span></span>
<span><span class="co">#&gt;  ‘/tmp/RtmpDKlA7e/downloaded_packages’</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; &gt; cowsay::say("Moo", "cow")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ----- </span></span>
<span><span class="co">#&gt; Moo </span></span>
<span><span class="co">#&gt;  ------ </span></span>
<span><span class="co">#&gt;     \   ^__^ </span></span>
<span><span class="co">#&gt;      \  (oo)\ ________ </span></span>
<span><span class="co">#&gt;         (__)\         )\ /\ </span></span>
<span><span class="co">#&gt;              ||------w|</span></span>
<span><span class="co">#&gt;              ||      ||</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Writing library description to 'hipercow/lib/.conan/20240126113056'</span></span>
<span><span class="co">#&gt; Done!</span></span></code></pre></div>
<p>Please be considerate and don’t write scripts that will take very
long to run (e.g., no longer than 10-15 minutes) or they may be killed
by the cluster scheduler. Please also let us know if you have a script
that takes this long.</p>
</div>
<div class="section level2">
<h2 id="using-renv">Using renv<a class="anchor" aria-label="anchor" href="#using-renv"></a>
</h2>
<p>If you are using <a href="https://rstudio.github.io/renv/" class="external-link"><code>renv</code></a> to set up
your packages, you can use this with hipercow, and this should be
detected automatically. With your renv project loaded and a lockfile
created (so that <code>renv::status()</code> reports “No issues found –
the project is in a consistent state.”) you should be able to run</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>and see <code>renv</code> build a new library based on your lockfile.
New tasks launched after this will use that library.</p>
<!--
It would be nice to show renv usage here, but it's hard to get working reliably because we don't actually want renv running in the vignette process, and callr won't reliably pick up renv from a non-renv session!
-->
<p>The workflow differs very slightly from using <code>renv</code>
normally in that we take some steps to prevent <code>renv</code>
updating the library automatically while your tasks run because this
will result in disaster if multiple tasks trigger this in parallel.</p>
</div>
<div class="section level2">
<h2 id="some-details-about-the-process">Some details about the process<a class="anchor" aria-label="anchor" href="#some-details-about-the-process"></a>
</h2>
<p>The general hope is that relatively little configuration or specific
calls are needed here, but this comes at the cost of a little magic.</p>
<p>If the <code>method</code> argument to
<code><a href="../reference/hipercow_provision.html">hipercow_provision()</a></code> is not given, then we use a simple
heuristic to select a method:</p>
<ul>
<li>If a file <code>provision.R</code> is present, we use the
<code>script</code> method; this takes precedence because it’s the
biggest, least clever hammer. You might use this as a last resort and so
it should override any other method that you might be using.</li>
<li>If a file <code>pkgdepends.txt</code> is present, we use the
<code>pkgdepends</code> method; we think that this method is a
reasonable tradeoff of predictability and usability and should cover
most people’s needs.</li>
<li>Otherwise we’ll try for an automatic installation; this is to help
people get started quickly.</li>
</ul>
<p>You can always pass the method explicitly and any arguments supported
by that method (see <code><a href="../reference/hipercow_provision.html">?hipercow_provision</a></code> for details). For
example, suppose you normally had things working with
<code>pkgdepends</code> but hit trouble with some incompatible set of
versions, you might write a file <code>fix_install.R</code> and run it
with:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hipercow_provision.html">hipercow_provision</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"script"</span>, script <span class="op">=</span> <span class="st">"fix_install.R"</span><span class="op">)</span></span></code></pre></div>
<p>If you interrupt the installation while it runs, it will not
(currently) cancel the running task. We may change this in the future.
Please don’t submit another provisioning task until yours is finished
(you can use the <a href="https://mrcdata.dide.ic.ac.uk/hpc/index.php" class="external-link">HPC portal</a> to
check easily).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley, Paul Liétar.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
